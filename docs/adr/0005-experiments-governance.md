# ADR 0005 — Governance للتجارب وA/B مع استدلال سببي

**التاريخ:** 2025-09-30

**الحالة:** مقترح

## السياق

يتطلب دمج نظام تجارب متقدم في Zebra، يدعم كلاً من اختبارات A/B التقليدية والتحليل السببي، سياسة حوكمة واضحة لضمان أن النتائج موثوقة وأن القرارات المستندة إليها آمنة.

## القرار

1.  **تسجيل التجربة (Experiment Logging):** يجب تسجيل كل تجربة جديدة يتم تعريفها في سجل مركزي. يجب أن يتضمن السجل على الأقل:
    *   `experiment_id`: معرف فريد.
    *   `hypothesis`: الفرضية التي يتم اختبارها.
    *   `variants`: قائمة بالمتغيرات (e.g., 'A', 'B').
    *   `design_parameters`: معلمات التصميم (effect_size, power, significance).
    *   `data_hash`: هاش لمجموعة البيانات المستخدمة للتحقق من سلامة البيانات.
    *   `owner`: الشخص أو الفريق المسؤول عن التجربة.

2.  **التحليل السببي كمتطلب (Causal Analysis as a Requirement):** لا يكفي التحليل التقليدي (مثل اختبار t) لاتخاذ قرارات مهمة. **يجب** أن يكون لكل تجربة تحليل سببي مصاحب (`estimate_ate`) لتقدير متوسط تأثير المعالجة (ATE)، مع مراعاة المتغيرات المربكة (confounders). إذا لم يكن التحليل السببي ممكنًا، فيجب توثيق مبرر واضح لذلك.

3.  **معايير القرار (Decision Criteria):** لا يتم اتخاذ قرار "تنفيذ" (implement) تلقائيًا. يجب أن تستوفي التوصية "Actionable" الشروط التالية:
    *   **الأهمية الإحصائية:** يجب أن يكون فاصل الثقة (confidence interval) لـ ATE لا يتضمن الصفر عند مستوى المعنوية المحدد مسبقًا (e.g., alpha = 0.05).
    *   **فحص الحساسية (Sensitivity Analysis):** يجب إجراء فحص حساسية للتحقق من قوة النتائج ضد المتغيرات المربكة غير الملحوظة.
    *   **صحة البيانات (Data Validity):** يجب التحقق من عدم وجود انحراف كبير في البيانات (data drift) أو مشكلات في توزيع المتغيرات بين المجموعات.
    *   **مراجعة بشرية (Human Review):** يجب مراجعة جميع النتائج والتوصيات "Actionable" والموافقة عليها من قبل مهندس أو محلل معين.

4.  **الإيقاف المبكر (Early Stopping):** يُسمح بالإيقاف المبكر للتجارب باستخدام طرق مثل SPRT أو Bayesian adaptive stopping، ولكن يجب تحديد القواعد والعتبات مسبقًا في تصميم التجربة. يجب تسجيل جميع قرارات الإيقاف المبكر وعدد العينات المستخدمة (`samples_used`) بوضوح في سجل التدقيق.

## المبررات

*   **الموثوقية:** يضمن التحليل السببي أننا نقيس التأثير الحقيقي للتدخل، وليس مجرد ارتباطات زائفة.
*   **السلامة:** تمنع معايير القرار الصارمة والمراجعة البشرية نشر تغييرات قد تكون ضارة أو غير فعالة.
*   **الكفاءة:** يسمح الإيقاف المبكر بتوفير الموارد عن طريق إنهاء التجارب غير الواعدة أو الناجحة بشكل واضح في وقت مبكر.

## العواقب

*   **زيادة التعقيد:** يتطلب التحليل السببي خبرة إضافية وبيانات أكثر تفصيلاً (confounders).
*   **الحاجة إلى أدوات قوية:** يتطلب هذا النهج وجود أدوات قوية لجمع البيانات، وتسجيل التجارب، وإجراء التحليلات.
*   **إطالة مدة التحليل:** قد يستغرق التحليل السببي وقتًا أطول من التحليل التقليدي.