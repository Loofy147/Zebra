# ADR 0008 — Governance & Circuit Breakers

**التاريخ:** 2025-09-30

**الحالة:** مقترح

## السياق

مع إضافة وحدات الحوكمة (`GovernanceSystem`) وقواطع الدوائر (`CircuitBreaker`)، يحتاج نظام Zebra إلى سياسة موحدة لضمان أن جميع القرارات والإجراءات التلقائية تخضع لرقابة صارمة وأن النظام يمكنه حماية نفسه من حالات الفشل الكارثي.

## القرار

1.  **التكامل الإلزامي مع نظام الحوكمة:** يجب أن تمر جميع القرارات التي يمكن أن تؤدي إلى إجراء تلقائي ("Actionable") عبر `GovernanceSystem.check_decision_compliance` قبل التنفيذ.

2.  **تطبيق قواطع الدوائر:** يجب أن تقوم خدمة المراقبة الرئيسية بتشغيل `CircuitBreaker.monitor_and_break` بشكل دوري على أحدث مقاييس أداء النظام.

3.  **فتح الدائرة (Circuit Open):** عند فتح الدائرة، يجب اتخاذ الإجراءات التالية تلقائيًا:
    *   **إيقاف جميع التحسينات الآلية:** يجب تعطيل أي وحدات يمكنها إجراء تغييرات على النظام (e.g., auto-remediation, self-healing).
    *   **التراجع إلى حالة آمنة (Rollback):** يجب التراجع عن آخر تغيير تم إجراؤه أو العودة إلى آخر تكوين معروف بأنه آمن.
    *   **إنشاء تنبيه عالي الأولوية:** يجب إرسال تنبيه فوري إلى فريق التشغيل (on-call team) عبر القنوات المحددة (e.g., PagerDuty, Slack).
    *   **تسجيل حدث تدقيق:** يجب تسجيل حدث فتح الدائرة بالكامل في `AuditLog`.

4.  **إعادة إغلاق الدائرة (Circuit Closing):** لا يتم إغلاق الدائرة تلقائيًا. يتطلب ذلك:
    *   **اختبار نصف مفتوح (Half-Open Test):** إجراء اختبار محدود ومراقب (e.g., canary deployment) للتحقق من أن المشكلة قد تم حلها.
    *   **موافقة بشرية:** يجب أن يوافق مهندس معين على إعادة إغلاق الدائرة بعد نجاح اختبار نصف مفتوح.

## المبررات

*   **السلامة أولاً:** تضمن قواطع الدوائر أن النظام يمكنه حماية نفسه من حالات الفشل المتتالية أو التدهور الحاد في الأداء.
*   **التحكم والشفافية:** يوفر نظام الحوكمة المركزي نقطة تحكم واحدة ويضمن أن جميع القرارات تخضع لنفس مجموعة القواعد.
*   **الاستجابة السريعة للحوادث:** تضمن التنبيهات الفورية وآليات التراجع التلقائي استجابة سريعة للحوادث وتقليل متوسط وقت الإصلاح (MTTR).

## العواقب

*   **زيادة التعقيد:** يضيف هذا النهج طبقات إضافية من التعقيد إلى النظام.
*   **احتمالية الإيجابيات الكاذبة (False Positives):** قد يتم فتح الدائرة بسبب إنذارات كاذبة، مما يؤدي إلى تعطيل غير ضروري للتحسينات التلقائية.
*   **الحاجة إلى تكامل قوي:** يتطلب هذا النهج تكاملاً قويًا بين جميع مكونات النظام (المراقبة، الحوكمة، قواطع الدوائر).